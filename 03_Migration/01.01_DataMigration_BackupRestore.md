# Data Migration with Backup and Restore

## Setup

Follow all the steps in the [Setup](./../05_Appendix/00_Setup.md) guide to create an environment to support the following steps.

## Data

> **NOTE** Format changes between versions may not be backwards compatible.

### Manual Backup

- Run the following command to find where your RDB file is located:

```bash
redis-cli config get dir
```

- Create a backup

```bash
bgsave
```

- Install Azure CLI

```bash
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```

- Run the following commands to save your RDB file to azure storage, be sure to replace the subscription id, resource group and storage account tokens:

```bash
az login

az ad signed-in-user show --query objectId -o tsv | az role assignment create --role "Storage Blob Data Contributor" --assignee @- --scope "/subscriptions/<subscription>/resourceGroups/<resource-group>/providers/Microsoft.Storage/storageAccounts/<storage-account>"

az storage container create --account-name <storage-account> --name <container> --auth-mode login

az storage blob upload  --account-name <storage-account> --container-name RedisBackup --name helloworld --file helloworld --auth-mode login
```

### Manual Restore (Attempt #1)

- For the Azure instance instance, expand the TODO

### Manual Restore (Attempt #2)

- For the Azure instance instance, expand TODO

#### Removing unsupported features

## Summary - Backup and Restore

Even a simple backup and restore operation can potentially require significant effort to restore to an Azure Cache for Redis instance.

Practice the above steps and document any items that were removed from the backup script during the actual migration. Record the time it takes to complete the entire migration.
