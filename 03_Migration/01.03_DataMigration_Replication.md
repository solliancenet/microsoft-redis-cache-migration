# Data Migration with Redis Replication

## Setup

Follow all the steps in the [Setup](./../05_Appendix/00_Setup.md) guide to create an environment to support the following steps.

> **Note** If the server is not enabled for SSL and is running 6.0 or higher, it is highly recommended that it is configured.  See [Configure Redis for SSL connectivity](../05_Appendix/04_ConfigurePostgresSSL.md) to enable SSL for the instance.

## Option 1 : Set to Read Only

- Run the following to set the source Redis server to read only:

```bash
redis-cli config set min-replicas-to-write 3

sudo service redis-server restart
```

## Option 2 : Rename Commands

This can also be accomplished by rename-ing all write commands.

- Open the `redis.conf` file, add the following lines:

```bash
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command SET ""
rename-command RENAME ""

sudo service redis-server restart
```

> **NOTE** This is not all write commands, add what you need to prevent any changes to your Redis instance during the migration.

## Replication (SLAVEOF) : Pre Redis 5.0

- Pre-5.0

## Replication (REPLICAOF) : 5.x or higher

- On the target server, run the following:

```bash
replicaof source_hostname_or_ip source_port
```

- Once replication has completed, run the following on the target:

```bash
replicaof no one
```

> TODO - does this work on Azure Redis???

## Resources

- 